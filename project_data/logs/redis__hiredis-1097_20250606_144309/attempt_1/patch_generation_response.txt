{"id":"f8675db6-486f-46dd-8cc1-c6a7c52b616a","object":"chat.completion","created":1749192214,"model":"deepseek-chat","choices":[{"index":0,"message":{"role":"assistant","content":"根据问题分析和测试变更，问题出现在redisvFormatCommand函数中对格式化字符串的处理上，特别是当遇到不完整的格式说明符（如\"%-\"）时会导致缓冲区溢出。以下是修复补丁：\n\n```diff\ndiff --git a/hiredis.c b/hiredis.c\nindex abc1234..def5678 100644\n--- a/hiredis.c\n+++ b/hiredis.c\n@@ -228,7 +228,7 @@ int redisvFormatCommand(char **target, const char *format, va_list ap) {\n                     /* Flags */\n                     while (*_p != '\\0' && strchr(flags,*_p) != NULL) _p++;\n \n-                    /* Field width */\n+                    /* Field width (check for end of string before accessing) */\n                     while (*_p != '\\0' && isdigit(*_p)) _p++;\n \n                     /* Precision */\n@@ -236,6 +236,9 @@ int redisvFormatCommand(char **target, const char *format, va_list ap) {\n                         _p++;\n                         while (*_p != '\\0' && isdigit(*_p)) _p++;\n                     }\n+                    \n+                    if (*_p == '\\0')\n+                        goto fmt_invalid;\n \n                     /* Copy va_list before consuming with va_arg */\n                     va_copy(_cpy,ap);\n```"},"logprobs":null,"finish_reason":"stop"}],"usage":{"prompt_tokens":13061,"completion_tokens":284,"total_tokens":13345,"prompt_tokens_details":{"cached_tokens":1920},"prompt_cache_hit_tokens":1920,"prompt_cache_miss_tokens":11141},"system_fingerprint":"fp_8802369eaa_prod0425fp8"}