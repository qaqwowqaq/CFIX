{"id":"ef0ad127-f25f-41c8-9b40-40d31234f2bd","object":"chat.completion","created":1749193492,"model":"deepseek-chat","choices":[{"index":0,"message":{"role":"assistant","content":"根据问题描述和上下文分析，需要在消息接收过程中添加连接状态检查。以下是修复补丁：\n\n```diff\ndiff --git a/src/nng.c b/src/nng.c\nindex abc1234..def5678 100644\n--- a/src/nng.c\n+++ b/src/nng.c\n@@ -120,6 +120,9 @@ nng_recvmsg(nng_socket s, nng_msg **msgp, int flags)\n \tif ((rv = nng_aio_result(ap)) == 0) {\n \t\t*msgp = nng_aio_get_msg(ap);\n \n+\t} else if (rv == NNG_ECLOSED) {\n+\t\trv = NNG_ECONNRESET;\n+\n \t} else if ((rv == NNG_ETIMEDOUT) && (flags == NNG_FLAG_NONBLOCK)) {\n \t\trv = NNG_EAGAIN;\n \t}\n@@ -129,6 +132,9 @@ nng_recvmsg(nng_socket s, nng_msg **msgp, int flags)\n \n void\n nng_recv_aio(nng_socket s, nng_aio *aio)\n {\n+\tif (nni_aio_get_prov_data(aio) == NULL) {\n+\t\tnni_aio_set_prov_data(aio, (void *)1);\n+\t}\n \tnni_sock *sock;\n \tint       rv;\n \n@@ -138,6 +144,10 @@ nng_recv_aio(nng_socket s, nng_aio *aio)\n \t\t}\n \t\treturn;\n \t}\n+\tif (nni_aio_get_prov_data(aio) == NULL) {\n+\t\tnni_aio_finish_error(aio, NNG_ECONNRESET);\n+\t\treturn;\n+\t}\n \tnni_sock_recv(sock, aio);\n \tnni_sock_rele(sock);\n }\n```"},"logprobs":null,"finish_reason":"stop"}],"usage":{"prompt_tokens":14582,"completion_tokens":425,"total_tokens":15007,"prompt_tokens_details":{"cached_tokens":128},"prompt_cache_hit_tokens":128,"prompt_cache_miss_tokens":14454},"system_fingerprint":"fp_8802369eaa_prod0425fp8"}